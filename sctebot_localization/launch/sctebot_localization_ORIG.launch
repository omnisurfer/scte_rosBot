<launch>
    <arg name="robot_namespace" default="sctebot"/>
    <arg name="pub_tf" default="false"/>
    <arg name="enable_simulation" default="false"/>

    <arg name="enable_ekf_odom" default="true"/>
    <arg name="enable_ekf_map" default="true"/>
    <arg name="enable_navsat_transform" default="true"/>

    <group ns="$(arg robot_namespace)">

        <group if="$(eval enable_ekf_odom == true)">

            <!--rosparam command="load" file="$(find sctebot_localization)/config/ekf_state_estimate_odom_map_navsat_ORIG.yaml" subst_value="true"/-->
            <!-- odom to base_link -->
            <rosparam command="load" file="$(find sctebot_localization)/config/ekf_state_estimate_odom.yaml" subst_value="true"/>
            <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_odom" clear_params="true"/>

        </group>

        <group if="$(eval enable_ekf_map == true)">

            <!-- map to odom -->
            <rosparam command="load" file="$(find sctebot_localization)/config/ekf_state_estimate_map.yaml" subst_value="true"/>
            <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_map" clear_params="true">
                <remap from="odometry/filtered" to="odometry/filtered_map"/>
            </node>

        </group>

        <group if="$(eval enable_navsat_transform == true)">

            <group if="$(eval enable_simulation == true)">
                <!-- Sea World
                <arg name="reference_Latitude" value="32.76428904214641"/>
                <arg name="reference_Longitude"> value="-117.22632586042305"/>
                <rosparam param="datum">[32.75394484000334, -117.21848979362261, 0.0, map, base_link]</rosparam>
                -->

                <!-- Yosemite parking lot
                <referenceLatitude>37.738448530273594</referenceLatitude>
                <referenceLongitude>-119.56968071496732</referenceLongitude>
                <rosparam param="datum">[37.738448530273594, -119.56968071496732, 0.0, map, base_link]</rosparam>
                -->

                <rosparam param="datum">[37.738448530273594, -119.56968071496732, 0.0, map, base_link]</rosparam>

                <node pkg="robot_localization" type="navsat_transform_node" name="gazebo_navsat_transform" clear_params="true">
                    <param name="magnetic_declination_radians" value="0"/>

                    <param name="yaw_offset" value="0"/>

                    <!-- Outputs -->
                    <!--remap from="odometry/gps" to="gazebo/odometry/gps" /-->

                    <!-- Inputs -->
                    <!--remap from="odometry/filtered" to="odometry/filtered"/-->
                    <!--remap from="gps/fix" to="gazebo/gps/fix"/-->
                    <!--remap from="imu/data" to="gazebo/imu"/-->
                </node>
            </group>

            <node pkg="robot_localization" type="navsat_transform_node" name="ultimate_gps_navsat_transform" clear_params="true">
                <param name="magnetic_declination_radians" value="0"/>

                <param name="yaw_offset" value="0"/>

                <!-- Outputs -->
                <remap from="odometry/gps" to="adafruit_ultimate_gps/odometry/gps"/>

                <!-- Inputs -->
                <remap from="imu/data" to="adafruit_10dof_imu/imu/data"/>
                <remap from="gps/fix" to="adafruit_ultimate_gps/gps/fix"/>
                <!--remap from="odometry/filtered" to="odometry/filtered"/-->
            </node>

        </group>

    </group>

</launch>